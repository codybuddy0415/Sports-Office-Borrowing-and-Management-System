<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sports Equipment Borrowing System</title>

  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Segoe UI;
      background: #f7fafc;
      color: #111;
    }

    /* ================= HEADER ================= */
    .top-header {
      height: 55px;
      background: #fff;
      border-bottom: 1px solid #ddd;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    /* ================= LAYOUT ================= */
    .container {
      display: flex;
      min-height: calc(100vh - 55px);
    }

    /* ================= SIDEBAR ================= */
    .sidebar {
      width: 230px;
      background: #0f172a;
      color: white;
      padding: 20px;
      display: flex;
      flex-direction: column;
      position: relative; /* REQUIRED */
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .sidebar-logo img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
    }

    .sidebar button {
      width: 100%;
      padding: 10px;
      margin-bottom: 8px;
      border: none;
      background: #142346;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }

    /* ================= ADMIN PROFILE ================= */
    .admin-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      background: #142346;
      padding: 10px;
      border-radius: 8px;

      position: absolute;
      bottom: 70px; /* ABOVE LOGOUT */
      left: 20px;
      right: 20px;
    }

    .admin-profile img {
      width: 30px;
      height: 30px;
      border-radius: 50%;
    }

    .admin-profile span {
      font-size: 12px;
      color: #cbd5e1;
    }

    /* ================= LOGOUT ================= */
    .sidebar button.logout {
      background: #740909;
      position: absolute;
      bottom: 20px;
      left: 20px;
      right: 20px;
    }

    /* ================= MAIN ================= */
    .main {
      flex: 1;
      padding: 20px;
      overflow-x: hidden;
    }

    /* ================= DASHBOARD ================= */
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }

    .card {
      background: white;
      padding: 25px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,.15);
    }

    .section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    /* ================= TABLES ================= */
    .table-box {
      background: white;
      border-radius: 8px;
      overflow-x: auto;
    }

    table {
      width: 100%;
      min-width: 650px;
      border-collapse: collapse;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }

    /* ================= MODAL ================= */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .modal.hidden {
      display: none;
    }

    .modal-box {
      background: white;
      width: 420px;
      max-width: 95%;
      padding: 20px;
      border-radius: 12px;
    }

    /* ================= MOBILE ================= */
    @media (max-width: 1024px) {
      .stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        padding-bottom: 10px;
      }

      .sidebar-logo {
        width: 100%;
        justify-content: center;
      }

      .sidebar button {
        width: 48%;
      }

      .admin-profile,
      .sidebar button.logout {
        position: relative;
        bottom: auto;
        left: auto;
        right: auto;
        width: 100%;
        margin-top: 10px;
      }

      .stats {
        grid-template-columns: 1fr;
      }

      table {
        min-width: 600px;
      }
    }

    @media (max-width: 480px) {
      .sidebar button {
        width: 100%;
      }

      .top-header {
        flex-direction: column;
        height: auto;
        padding: 10px;
      }
    }
  </style>>
  </head>
  <body>
    <header class="top-header">
      <h2>Sports Equipment Borrowing System</h2>
      <div class="header-right">
        <span id="currentDate"></span>
        <button class="theme-toggle" onclick="toggleTheme()">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </header>

    <div class="container">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-logo">
          <img src="SCC logo 2.png" alt="SCC Logo" />
          <h3>SCC Sports Office</h3>
        </div>

        <button onclick="show('dashboard')">Dashboard</button>
        <button onclick="show('equipment')">Equipment</button>
        <button onclick="show('borrow')">Borrow</button>
        <button onclick="show('reports')">Reports</button>

        <div class="admin-profile">
          <img src="SCC logo 2.png" alt="Admin" />
          <div>
            <strong>Admin</strong>
            <span>Sports Office</span>
          </div>
        </div>

        <button class="logout" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>

      <!-- Main -->
      <div class="main">
        <button class="hidden" onclick="toggleTheme()"></button>

        <!-- Dashboard -->
        <div id="dashboard">
          <h1>Dashboard</h1>
          <div class="stats">
            <div class="card">
              TOTAL <i class="fas fa-box"></i><br /><span id="total">0</span>
            </div>
            <div class="card">
              BORROWED <i class="fas fa-clipboard-list"></i><br /><span
                id="borrowed"
                >0</span
              >
            </div>
            <div class="card">
              AVAILABLE <i class="fas fa-clipboard-check"></i><br /><span
                id="available"
                >0</span
              >
            </div>
            <div class="card">
              BORROWERS <i class="fas fa-user-alt"></i><br /><span id="count"
                >0</span
              >
            </div>
          </div>
          <div class="section">
            <h3>
              <i
                class="fas fa-warning"
                style="font-size: 25px; color: rgba(255, 0, 0, 0.829)"
              ></i
              >Warnings
            </h3>
            <ul id="warnings"></ul>
          </div>
          <div class="section">
            <h3>Current Borrowers</h3>
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Equipment</th>
                  <th>Qty</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="dashboardBorrowers"></tbody>
            </table>
          </div>
          <div class="section">
            <h3>Equipment Inventory</h3>
            <table>
              <thead>
                <tr>
                  <th>Equipment</th>
                  <th>Total</th>
                  <th>Available</th>
                  <th>Borrowed</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="dashboardInventory"></tbody>
            </table>
          </div>
        </div>

        <!-- Equipment Management -->
        <div id="equipment" class="hidden">
          <h1>Inventory Management</h1>
          <p>Track and manage sports equipment.</p>
          <div class="top-actions">
            <input
              type="text"
              placeholder="ðŸ”Žï¸Ž Search equipment..."
              onkeyup="searchEquipment(this.value)"
            />
            <button class="add-btn" onclick="toggleAddForm()">
              <i class="fas fa-plus"></i> Add Item
            </button>
          </div>
          <div id="addModal" class="modal hidden">
            <div class="modal-box">
              <div class="modal-close" onclick="toggleAddForm()">
                <i class="fas fa-times"></i>
              </div>

              <h2>Add Equipment</h2>

              <input id="eqName" placeholder="Equipment Name" />
              <input id="eqType" placeholder="Brand / Category" />
              <input id="eqQty" type="number" placeholder="Total Quantity" />

              <select id="eqCondition">
                <option>New</option>
                <option>Good</option>
                <option>Fair</option>
                <option>Bad</option>
              </select>

              <button class="action" onclick="addEquipment()">Save Item</button>
            </div>
          </div>

          <div class="table-box">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Category</th>
                  <th>Condition</th>
                  <th>Available</th>
                  <th>Total</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="eqTable"></tbody>
            </table>
          </div>
        </div>

        <!-- Borrow Management -->
        <div id="borrow" class="hidden">
          <h1>Borrow Management</h1>
          <p>Manage student loans and returns.</p>
          <div class="top-actions">
            <input
              type="text"
              placeholder="ðŸ”Žï¸Ž Search student or item..."
              onkeyup="searchBorrowers(this.value)"
            />
            <button class="add-loan-btn" onclick="toggleBorrowForm()">
              <i class="fas fa-plus"></i> New Loan
            </button>
          </div>
          <div id="borrowModal" class="modal hidden">
            <div class="modal-box">
              <div class="modal-close" onclick="toggleBorrowForm()">
                <i class="fas fa-times"></i>
              </div>

              <h2>New Loan</h2>

              <input id="bName" placeholder="Borrower Name" />
              <input id="bID" placeholder="ID Number" />
              <input id="bCourse" placeholder="Purpose" />

              <select id="bEquip"></select>

              <input id="bQty" type="number" placeholder="Quantity" />
              <input id="bDue" type="date" />

              <button class="action" onclick="borrow()">Save Loan</button>
            </div>
          </div>

          <div class="table-box">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>ID</th>
                  <th>Purpose</th>
                  <th>Equipment</th>
                  <th>Qty</th>
                  <th>Status</th>
                  <th>Borrowed</th>
                  <th>Due</th>
                  <th>Returned</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="borrowTable"></tbody>
            </table>
          </div>
        </div>

        <!-- Reports -->
        <div id="reports" class="hidden">
          <h1>Reports</h1>
          <div class="top-actions">
            <button class="action filter" onclick="toggleFilterModal()">
              <i class="fas fa-filter"></i> Filter
            </button>
            <button class="action print" onclick="window.print()">
              Print / PDF
            </button>
          </div>
          <div id="filterModal" class="modal hidden">
            <div class="modal-box">
              <div class="modal-close" onclick="toggleFilterModal()">
                <i class="fas fa-times"></i>
              </div>

              <h3>Filter Reports</h3>

              <label>From Date</label>
              <input type="date" id="fromDate" />

              <label>To Date</label>
              <input type="date" id="toDate" />

              <div style="display: flex; gap: 10px; margin-top: 15px">
                <button class="action filter" onclick="applyReportFilter()">
                  Apply
                </button>
                <button class="action reset" onclick="resetReports()">
                  Reset
                </button>
              </div>
            </div>
          </div>
          <div class="table-box">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>ID</th>
                  <th>Equipment</th>
                  <th>Qty</th>
                  <th>Status</th>
                  <th>Borrowed</th>
                </tr>
              </thead>
              <tbody id="reportBorrowers"></tbody>
            </table>
          </div>
          <div class="table-box">
            <h3>Equipment Inventory</h3>
            <table>
              <thead>
                <tr>
                  <th>Equipment</th>
                  <th>Total</th>
                  <th>Available</th>
                  <th>Borrowed</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="reportInventory"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Initialize storage
      let equipments = JSON.parse(localStorage.getItem("equipments")) || [];
      let borrowers = JSON.parse(localStorage.getItem("borrowers")) || [];

      // Show date
      document.getElementById("currentDate").textContent =
        new Date().toDateString();

      // Navigation
      function show(id) {
        document
          .querySelectorAll(".main>div")
          .forEach((d) => d.classList.add("hidden"));
        document.getElementById(id).classList.remove("hidden");
      }

      // Dark mode
      function toggleTheme() {
        document.body.classList.toggle("dark");

        const icon = document.querySelector(".theme-toggle i");

        if (document.body.classList.contains("dark")) {
          icon.classList.remove("fa-moon");
          icon.classList.add("fa-sun");
        } else {
          icon.classList.remove("fa-sun");
          icon.classList.add("fa-moon");
        }
      }

      // Toggle forms
      function toggleAddForm() {
        document.getElementById("addModal").classList.toggle("hidden");
      }

      function toggleBorrowForm() {
        document.getElementById("borrowModal").classList.toggle("hidden");
      }
      function toggleFilterModal() {
        document.getElementById("filterModal").classList.toggle("hidden");
      }
      // Close modal when clicking outside the modal box
      document.addEventListener("click", function (e) {
        if (e.target.classList.contains("modal")) {
          e.target.classList.add("hidden");
        }
      });

      // Logout
      function logout() {
        if (confirm("Logout?")) window.location.href = "index.html";
      }

      // Save to localStorage
      function save() {
        localStorage.setItem("equipments", JSON.stringify(equipments));
        localStorage.setItem("borrowers", JSON.stringify(borrowers));
      }

      // Render all
      function render() {
        let eqTable = document.getElementById("eqTable");
        let bEquip = document.getElementById("bEquip");
        let borrowTable = document.getElementById("borrowTable");
        let warnings = document.getElementById("warnings");
        let dashboardBorrowers = document.getElementById("dashboardBorrowers");
        let dashboardInventory = document.getElementById("dashboardInventory");
        let reportBorrowers = document.getElementById("reportBorrowers");
        eqTable.innerHTML =
          bEquip.innerHTML =
          borrowTable.innerHTML =
          warnings.innerHTML =
          dashboardBorrowers.innerHTML =
          dashboardInventory.innerHTML =
          reportBorrowers.innerHTML =
            "";

        let today = new Date().toISOString().split("T")[0];

        // Equipments
        equipments.forEach((e, i) => {
          let borrowedQty = e.total - e.avail;
          let statusClass =
            e.avail === 0 ? "bad" : e.avail <= 2 ? "fair" : "good";
          let statusText =
            e.avail === 0
              ? "Out of Stock"
              : e.avail <= 2
                ? "Low Stock"
                : "Available";
          if (e.avail <= 2)
            warnings.innerHTML += `<li>Low stock: ${e.name} (${e.avail})</li>`;
          eqTable.innerHTML += `
            <tr>
                <td>${e.name}</td>
                <td>${e.type}</td>
                <td><span class="badge ${e.condition.toLowerCase()}">${e.condition}</span></td>
                <td>${e.avail}</td>
                <td>${e.total}</td>
                <td>
                <span class="badge ${statusClass}">${statusText}</span>
                <div class="actions">
                <i class="fas fa-pen" onclick="editEquipment(${i})"></i>
                <i class="fas fa-trash" onclick="deleteEquipment(${i})"></i>
                </div>
                </td>
            </tr>`;
          bEquip.innerHTML += `<option value="${i}">${e.name}</option>`;

          // Dashboard inventory
          dashboardInventory.innerHTML += `
            <tr>
                <td>${e.name}</td>
                <td>${e.total}</td>
                <td>${e.avail}</td>
                <td>${borrowedQty}</td>
                <td><span class="badge ${statusClass}">${statusText}</span></td>
                <td>
                  <div class="actions">
                    <i class="fas fa-pen" onclick="editEquipment(${i})" title="Edit"></i>
                    <i class="fas fa-trash" onclick="deleteEquipment(${i})" title="Delete"></i>
                  </div>
                </td>
              </tr>`;
        });

        // Borrowers
        borrowers.forEach((b, i) => {
          let status = b.status;
          let statusClass = "borrowed";
          if (status === "Returned") statusClass = "returned";
          if (status === "Borrowed" && today > b.due) {
            status = "Overdue";
            statusClass = "overdue";
            warnings.innerHTML += `<li>Overdue: ${b.name} (${b.equip})</li>`;
          }
          borrowTable.innerHTML += `
          <tr>
              <td>${b.name}</td>
              <td>${b.id}</td>
              <td>${b.course}</td>
              <td>${b.equip}</td>
              <td>${b.qty}</td>
              <td><span class="status-pill ${statusClass}">${status}</span></td>
              <td>${b.borrowed}</td>
              <td>${b.due}</td>
              <td>${b.returned}</td>
              <td>${b.status !== "Returned" ? `<button class="action return" onclick="returnItem(${i})">Return</button>` : "â€”"}</td>
            </tr>`;
          dashboardBorrowers.innerHTML += `
            <tr>
                <td>${b.name}</td>
                <td>${b.equip}</td>
                <td>${b.qty}</td>
                <td><span class="status-pill ${statusClass}">${status}</span></td>
            </tr>`;
          reportBorrowers.innerHTML += `
          <tr>
              <td>${b.name}</td>
              <td>${b.id}</td>
              <td>${b.equip}</td>
              <td>${b.qty}</td>
              <td><span class="status-pill ${statusClass}">${status}</span></td>
              <td>${b.borrowed}</td>
          </tr>`;

          let reportInventory = document.getElementById("reportInventory");
          reportInventory.innerHTML = "";

          equipments.forEach((e, i) => {
            let borrowedQty = e.total - e.avail;
            let statusClass =
              e.avail === 0 ? "bad" : e.avail <= 2 ? "fair" : "good";
            let statusText =
              e.avail === 0
                ? "Out of Stock"
                : e.avail <= 2
                  ? "Low Stock"
                  : "Available";

            reportInventory.innerHTML += `
        <tr>
          <td>${e.name}</td>
          <td>${e.total}</td>
          <td>${e.avail}</td>
          <td>${borrowedQty}</td>
          <td><span class="badge ${statusClass}">${statusText}</span></td>
        </tr>
  `;
          });
        });

        // Dashboard stats
        let totalT = equipments.reduce((s, e) => s + e.total, 0);
        let availT = equipments.reduce((s, e) => s + e.avail, 0);
        document.getElementById("total").innerText = totalT;
        document.getElementById("available").innerText = availT;
        document.getElementById("borrowed").innerText = totalT - availT;
        document.getElementById("count").innerText = borrowers.length;
      }

      // Add/Edit/Delete/Return
      function addEquipment() {
        let name = document.getElementById("eqName").value;
        let type = document.getElementById("eqType").value;
        let qty = parseInt(document.getElementById("eqQty").value);
        let condition = document.getElementById("eqCondition").value;
        if (!name || !type || !qty) return alert("Fill all fields");
        equipments.push({ name, type, total: qty, avail: qty, condition });
        document.getElementById("eqName").value =
          document.getElementById("eqType").value =
          document.getElementById("eqQty").value =
            "";
        save();
        render();
        toggleAddForm();
      }

      function editEquipment(i) {
        let e = equipments[i];
        let name = prompt("Name", e.name);
        if (!name) return;
        let type = prompt("Category", e.type);
        if (!type) return;
        let total = parseInt(prompt("Total", e.total));
        if (isNaN(total)) return alert("Invalid");
        let borrowed = e.total - e.avail;
        if (total < borrowed) return alert("Cannot reduce below borrowed");
        let condition = prompt("Condition", e.condition);
        if (!condition) return;
        e.name = name;
        e.type = type;
        e.total = total;
        e.avail = total - borrowed;
        e.condition = condition;
        save();
        render();
      }

      function deleteEquipment(i) {
        if (borrowers.some((b) => b.idx === i && b.status !== "Returned"))
          return alert("Cannot delete active borrowed equipment");
        if (confirm("Delete?")) {
          equipments.splice(i, 1);
          save();
          render();
        }
      }

      function borrow() {
        let i = parseInt(document.getElementById("bEquip").value);
        let q = parseInt(document.getElementById("bQty").value);
        let due = document.getElementById("bDue").value;
        let name = document.getElementById("bName").value;
        let id = document.getElementById("bID").value;
        let course = document.getElementById("bCourse").value;
        if (q <= 0 || q > equipments[i].avail) return alert("Invalid quantity");
        if (!due) return alert("Select due date");
        equipments[i].avail -= q;
        borrowers.push({
          name,
          id,
          course,
          equip: equipments[i].name,
          idx: i,
          qty: q,
          status: "Borrowed",
          borrowed: new Date().toISOString().split("T")[0],
          due,
          returned: "â€”",
        });
        document.getElementById("bName").value =
          document.getElementById("bID").value =
          document.getElementById("bCourse").value =
          document.getElementById("bQty").value =
          document.getElementById("bDue").value =
            "";
        save();
        render();
      }

      function returnItem(i) {
        borrowers[i].status = "Returned";
        borrowers[i].returned = new Date().toISOString().split("T")[0];
        equipments[borrowers[i].idx].avail += borrowers[i].qty;
        save();
        render();
      }

      // Reports filter/reset
      function applyReportFilter() {
        let from = document.getElementById("fromDate").value;
        let to = document.getElementById("toDate").value;

        render();

        if (from || to) {
          reportBorrowers.innerHTML = "";

          borrowers
            .filter(
              (b) => (!from || b.borrowed >= from) && (!to || b.borrowed <= to),
            )
            .forEach((b) => {
              let statusClass = "borrowed";
              if (b.status === "Returned") statusClass = "returned";
              if (
                b.status === "Borrowed" &&
                new Date().toISOString().split("T")[0] > b.due
              )
                statusClass = "overdue";

              reportBorrowers.innerHTML += `
          <tr>
            <td>${b.name}</td>
            <td>${b.id}</td>
            <td>${b.equip}</td>
            <td>${b.qty}</td>
            <td><span class="status-pill ${statusClass}">${b.status}</span></td>
            <td>${b.borrowed}</td>
          </tr>`;
            });
        }

        function resetReports() {
          document.getElementById("fromDate").value = document.getElementById(
            "toDate",
          ).value = "";
          render();
          toggleFilterModal();
        }
      }

      function resetReports() {
        document.getElementById("fromDate").value = document.getElementById(
          "toDate",
        ).value = "";
        render();
      }

      function searchEquipment(keyword) {
        keyword = keyword.toLowerCase();
        let rows = document.querySelectorAll("#eqTable tr");

        rows.forEach((row) => {
          let text = row.innerText.toLowerCase();
          row.style.display = text.includes(keyword) ? "" : "none";
        });
      }

      function searchBorrowers(keyword) {
        keyword = keyword.toLowerCase();
        let rows = document.querySelectorAll("#borrowTable tr");

        rows.forEach((row) => {
          let text = row.innerText.toLowerCase();
          row.style.display = text.includes(keyword) ? "" : "none";
        });
      }

      function toggleFilterModal() {
        document.getElementById("filterModal").classList.toggle("hidden");
      }

      // Initial render
      render();
    </script>
  </body>
</html>

