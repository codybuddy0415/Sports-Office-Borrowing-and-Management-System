<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Sports Equipment Borrowing System</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <style>
      body {
        margin: 0;
        font-family: Segoe UI;
        background: #f7fafc;
        color: #111;
      }
      .top-header {
        height: 55px;
        background: #fff;
        border-bottom: 1px solid #ddd;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 20px;
      }
      .top-header h2 {
        font-size: 18px;
        font-weight: 600;
        color: #203a43;
      }
      .header-right {
        display: flex;
        align-items: center;
        gap: 15px;
        font-size: 13px;
      }
      .theme-toggle {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
        color: #555;
      }
      .container {
        display: flex;
        height: 100vh;
      }
      .sidebar {
        width: 230px;
        background: #0f172a;
        color: white;
        padding: 20px;
        display: flex;
        flex-direction: column;
      }
      .sidebar button {
        width: 100%;
        padding: 10px;
        margin-bottom: 8px;
        border: none;
        background: #142346;
        color: white;
        border-radius: 5px;
        cursor: pointer;
      }
      .sidebar button.logout {
        background: #740909;
        margin-top: auto;
      }
      .main {
        flex: 1;
        padding: 20px;
        overflow: auto;
        position: relative;
      }
      .mode-toggle {
        position: absolute;
        top: 15px;
        right: 20px;
        cursor: pointer;
        font-size: 16px;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        color: #334155;
      }
      .mode-toggle:hover {
        background: rgba(0, 0, 0, 0.08);
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        margin-bottom: 15px;
      }
      .card {
        background: white;
        padding: 35px;
        border-radius: 8px;
        text-align: center;
        font-weight: bold;
        border: px solid #9a9a9b;
        box-shadow: 0px 5px 15px rgba(5, 21, 240, 0.438);
      }
      .section {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 15px;
        border: px solid #9a9a9b;
        box-shadow: 0px 5px 15px rgba(8, 44, 206, 0.555);
      }
      .hidden {
        display: none;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 10px;
        border-bottom: 1px solid #ddd;
        text-align: center;
        outline: #020617;
      }
      input,
      select {
        width: 100%;
        padding: 6px;
        margin-bottom: 8px;
        border: 1px solid #cbd5e1;
        border-radius: 5px;
      }
      button.action {
        background: #22c55e;
        border: none;
        color: white;
        padding: 6px 10px;
        border-radius: 5px;
        cursor: pointer;
      }
      button.return {
        background: #f97316;
      }
      button.print {
        background: #2563eb;
      }
      button.filter {
        background: #0ea5e9;
      }
      button.reset {
        background: #64748b;
      }
      .badge {
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        display: inline-block;
      }
      .badge.new {
        background: #ecfeff;
        color: #155e75;
      }
      .badge.good {
        background: #dcfce7;
        color: #166534;
      }
      .badge.fair {
        background: #fef3c7;
        color: #92400e;
      }
      .badge.bad {
        background: #fee2e2;
        color: #991b1b;
      }
      .actions i {
        cursor: pointer;
        margin-right: 10px;
        color: #64748b;
      }
      .actions i:hover {
        color: #2563eb;
      }
      .status-pill {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        color: white;
        display: inline-block;
      }
      .status-pill.borrowed {
        background: #f59e0b;
      }
      .status-pill.returned {
        background: #22c55e;
      }
      .status-pill.overdue {
        background: #dc2626;
      }
      body.dark {
        background: #121212;
        color: white;
      }
      body.dark .sidebar {
        background: #020617;
      }
      body.dark .card,
      .dark .section,
      .dark table {
        background: #020617;
        color: white;
      }
      body.dark th,
      body.dark td {
        border-color: #1e293b;
      }
      body.dark .top-header {
        background: #1e1e1e;
        border-color: #333;
      }
      body.dark h2 {
        color: white;
      }
      .table-box {
        background: white;
        border-radius: 8px;
        overflow: hidden;
        border: 0.5px solid #9a9a9b;
        box-shadow: 0px 5px 15px rgba(7, 164, 236, 0.25);
      }

      /* Top actions container */
      .top-actions {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
      }

      /* Search input style */
      .top-actions input[type="text"] {
        width: 250px;
        padding: 8px 12px;
        border-radius: 8px;
        border: 1px solid #cbd5e1;
        font-size: 14px;
        margin-bottom: auto;
      }

      /* Aesthetic Add buttons */
      .add-btn,
      .add-loan-btn {
        background: #2563eb;
        color: white;
        border: none;
        padding: 9px 18px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: 0.3s;
      }
      .add-btn:hover,
      .add-loan-btn:hover {
        background: #1d4ed8;
      }
      /* ===== OVERLAY MODAL ===== */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.55);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 999;
      }

      .hidden {
        display: none !important;
      }

      .modal-box {
        background: white;
        width: 420px;
        max-width: 90%;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        position: relative;
      }

      .modal-box h2 {
        margin-bottom: 15px;
      }

      .modal-close {
        position: absolute;
        top: 12px;
        right: 15px;
        font-size: 18px;
        cursor: pointer;
      }

      body.dark .modal-box {
        background: #020617;
        color: white;
      }

      #focusBtn:focus {
        background: #0ea5e9;
      }

      .sidebar-logo {
        display: flex;
        justify-content: center;
        margin-bottom: 1px;
      }

      .sidebar-logo img {
        width: 55px;
        height: 55px;
        border-radius: 50%;
        object-fit: cover;
      }

      .admin-profile {
        display: flex;
        align-items: center;
        gap: 10px;
        background: #142346;
        padding: 10px;
        border-radius: 8px;
        width: 210px;

        /* FIXED LOCATION */
        position: absolute;
        bottom: 13px; /* sits above logout */
        left: 20px;
        right: 20px;
      }

      .admin-profile img {
        width: 30px;
        height: 25px;
        border-radius: 50%;
        object-fit: cover;
      }

      .admin-profile strong {
        font-size: 14px;
      }

      .admin-profile span {
        font-size: 12px;
        color: #cbd5e1;
      }
      /* ===============================
   ðŸ“± MOBILE RESPONSIVE STYLES
   =============================== */

      @media (max-width: 1024px) {
        .stats {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      /* ===== MOBILE VIEW ===== */
      @media (max-width: 768px) {
        body {
          font-size: 14px;
        }

        .container {
          flex-direction: column;
          height: auto;
        }

        /* Header */
        .top-header {
          flex-direction: column;
          height: auto;
          gap: 5px;
          padding: 10px;
        }

        /* Sidebar */
        .sidebar {
          width: 100%;
          flex-direction: row;
          flex-wrap: wrap;
          justify-content: center;
          padding: 10px;
        }

        .sidebar-logo {
          width: 100%;
          justify-content: center;
        }

        .sidebar button {
          width: 48%;
          margin: 4px;
          font-size: 13px;
        }

        .sidebar button.logout {
          width: 100%;
        }

        .admin-profile {
          width: 100%;
          justify-content: center;
          margin: 10px 0;
        }

        /* Main content */
        .main {
          padding: 10px;
        }

        /* Dashboard cards */
        .stats {
          grid-template-columns: 1fr;
        }

        .card {
          padding: 20px;
        }

        /* Top action buttons */
        .top-actions {
          flex-direction: column;
          align-items: stretch;
        }

        .top-actions input {
          width: 100%;
        }

        .add-btn,
        .add-loan-btn {
          width: 100%;
          justify-content: center;
        }

        /* Tables */
        .table-box {
          overflow-x: auto;
        }

        table {
          min-width: 650px;
        }

        /* Modals */
        .modal-box {
          width: 95%;
          padding: 20px;
        }

        .modal-box h2 {
          font-size: 18px;
        }
      }

      /* ===== EXTRA SMALL PHONES ===== */
      @media (max-width: 480px) {
        .sidebar button {
          width: 100%;
        }

        .top-header h2 {
          font-size: 16px;
          text-align: center;
        }

        .header-right {
          flex-direction: column;
          gap: 5px;
        }

        input,
        select {
          font-size: 14px;
        }

        button {
          font-size: 14px;
        }
      }
    </style>
  </head>
  <body>
    <header class="top-header">
      <h2>Sports Equipment Borrowing System</h2>
      <div class="header-right">
        <span id="currentDate"></span>
        <button class="theme-toggle" onclick="toggleTheme()">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </header>

    <div class="container">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-logo">
          <img src="SCC logo 2.png" alt="SCC Logo" />
          <h3>SCC Sports Office</h3>
        </div>

        <button onclick="show('dashboard')">Dashboard</button>
        <button onclick="show('equipment')">Equipment</button>
        <button onclick="show('borrow')">Borrow</button>
        <button onclick="show('reports')">Reports</button>

        <div class="admin-profile">
          <img src="SCC logo 2.png" alt="Admin" />
          <div>
            <strong>Admin</strong>
            <span>Sports Office</span>
          </div>
        </div>

        <button class="logout" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>

      <!-- Main -->
      <div class="main">
        <button class="hidden" onclick="toggleTheme()"></button>

        <!-- Dashboard -->
        <div id="dashboard">
          <h1>Dashboard</h1>
          <div class="stats">
            <div class="card">
              TOTAL <i class="fas fa-box"></i><br /><span id="total">0</span>
            </div>
            <div class="card">
              BORROWED <i class="fas fa-clipboard-list"></i><br /><span
                id="borrowed"
                >0</span
              >
            </div>
            <div class="card">
              AVAILABLE <i class="fas fa-clipboard-check"></i><br /><span
                id="available"
                >0</span
              >
            </div>
            <div class="card">
              BORROWERS <i class="fas fa-user-alt"></i><br /><span id="count"
                >0</span
              >
            </div>
          </div>
          <div class="section">
            <h3>
              <i
                class="fas fa-warning"
                style="font-size: 25px; color: rgba(255, 0, 0, 0.829)"
              ></i
              >Warnings
            </h3>
            <ul id="warnings"></ul>
          </div>
          <div class="section">
            <h3>Current Borrowers</h3>
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Equipment</th>
                  <th>Qty</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="dashboardBorrowers"></tbody>
            </table>
          </div>
          <div class="section">
            <h3>Equipment Inventory</h3>
            <table>
              <thead>
                <tr>
                  <th>Equipment</th>
                  <th>Total</th>
                  <th>Available</th>
                  <th>Borrowed</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="dashboardInventory"></tbody>
            </table>
          </div>
        </div>

        <!-- Equipment Management -->
        <div id="equipment" class="hidden">
          <h1>Inventory Management</h1>
          <p>Track and manage sports equipment.</p>
          <div class="top-actions">
            <input
              type="text"
              placeholder="ðŸ”Žï¸Ž Search equipment..."
              onkeyup="searchEquipment(this.value)"
            />
            <button class="add-btn" onclick="toggleAddForm()">
              <i class="fas fa-plus"></i> Add Item
            </button>
          </div>
          <div id="addModal" class="modal hidden">
            <div class="modal-box">
              <div class="modal-close" onclick="toggleAddForm()">
                <i class="fas fa-times"></i>
              </div>

              <h2>Add Equipment</h2>

              <input id="eqName" placeholder="Equipment Name" />
              <input id="eqType" placeholder="Brand / Category" />
              <input id="eqQty" type="number" placeholder="Total Quantity" />

              <select id="eqCondition">
                <option>New</option>
                <option>Good</option>
                <option>Fair</option>
                <option>Bad</option>
              </select>

              <button class="action" onclick="addEquipment()">Save Item</button>
            </div>
          </div>

          <div class="table-box">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Category</th>
                  <th>Condition</th>
                  <th>Available</th>
                  <th>Total</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="eqTable"></tbody>
            </table>
          </div>
        </div>

        <!-- Borrow Management -->
        <div id="borrow" class="hidden">
          <h1>Borrow Management</h1>
          <p>Manage student loans and returns.</p>
          <div class="top-actions">
            <input
              type="text"
              placeholder="ðŸ”Žï¸Ž Search student or item..."
              onkeyup="searchBorrowers(this.value)"
            />
            <button class="add-loan-btn" onclick="toggleBorrowForm()">
              <i class="fas fa-plus"></i> New Loan
            </button>
          </div>
          <div id="borrowModal" class="modal hidden">
            <div class="modal-box">
              <div class="modal-close" onclick="toggleBorrowForm()">
                <i class="fas fa-times"></i>
              </div>

              <h2>New Loan</h2>

              <input id="bName" placeholder="Borrower Name" />
              <input id="bID" placeholder="ID Number" />
              <input id="bCourse" placeholder="Purpose" />

              <select id="bEquip"></select>

              <input id="bQty" type="number" placeholder="Quantity" />
              <input id="bDue" type="date" />

              <button class="action" onclick="borrow()">Save Loan</button>
            </div>
          </div>

          <div class="table-box">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>ID</th>
                  <th>Purpose</th>
                  <th>Equipment</th>
                  <th>Qty</th>
                  <th>Status</th>
                  <th>Borrowed</th>
                  <th>Due</th>
                  <th>Returned</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="borrowTable"></tbody>
            </table>
          </div>
        </div>

        <!-- Reports -->
        <div id="reports" class="hidden">
          <h1>Reports</h1>
          <div class="top-actions">
            <button class="action filter" onclick="toggleFilterModal()">
              <i class="fas fa-filter"></i> Filter
            </button>
            <button class="action print" onclick="window.print()">
              Print / PDF
            </button>
          </div>
          <div id="filterModal" class="modal hidden">
            <div class="modal-box">
              <div class="modal-close" onclick="toggleFilterModal()">
                <i class="fas fa-times"></i>
              </div>

              <h3>Filter Reports</h3>

              <label>From Date</label>
              <input type="date" id="fromDate" />

              <label>To Date</label>
              <input type="date" id="toDate" />

              <div style="display: flex; gap: 10px; margin-top: 15px">
                <button class="action filter" onclick="applyReportFilter()">
                  Apply
                </button>
                <button class="action reset" onclick="resetReports()">
                  Reset
                </button>
              </div>
            </div>
          </div>
          <div class="table-box">
            <table>
              <thead>
                <tr>
                  <th>Name</th>
                  <th>ID</th>
                  <th>Equipment</th>
                  <th>Qty</th>
                  <th>Status</th>
                  <th>Borrowed</th>
                </tr>
              </thead>
              <tbody id="reportBorrowers"></tbody>
            </table>
          </div>
          <div class="table-box">
            <h3>Equipment Inventory</h3>
            <table>
              <thead>
                <tr>
                  <th>Equipment</th>
                  <th>Total</th>
                  <th>Available</th>
                  <th>Borrowed</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="reportInventory"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Initialize storage
      let equipments = JSON.parse(localStorage.getItem("equipments")) || [];
      let borrowers = JSON.parse(localStorage.getItem("borrowers")) || [];

      // Show date
      document.getElementById("currentDate").textContent =
        new Date().toDateString();

      // Navigation
      function show(id) {
        document
          .querySelectorAll(".main>div")
          .forEach((d) => d.classList.add("hidden"));
        document.getElementById(id).classList.remove("hidden");
      }

      // Dark mode
      function toggleTheme() {
        document.body.classList.toggle("dark");

        const icon = document.querySelector(".theme-toggle i");

        if (document.body.classList.contains("dark")) {
          icon.classList.remove("fa-moon");
          icon.classList.add("fa-sun");
        } else {
          icon.classList.remove("fa-sun");
          icon.classList.add("fa-moon");
        }
      }

      // Toggle forms
      function toggleAddForm() {
        document.getElementById("addModal").classList.toggle("hidden");
      }

      function toggleBorrowForm() {
        document.getElementById("borrowModal").classList.toggle("hidden");
      }
      function toggleFilterModal() {
        document.getElementById("filterModal").classList.toggle("hidden");
      }
      // Close modal when clicking outside the modal box
      document.addEventListener("click", function (e) {
        if (e.target.classList.contains("modal")) {
          e.target.classList.add("hidden");
        }
      });

      // Logout
      function logout() {
        if (confirm("Logout?")) window.location.href = "index.html";
      }

      // Save to localStorage
      function save() {
        localStorage.setItem("equipments", JSON.stringify(equipments));
        localStorage.setItem("borrowers", JSON.stringify(borrowers));
      }

      // Render all
      function render() {
        let eqTable = document.getElementById("eqTable");
        let bEquip = document.getElementById("bEquip");
        let borrowTable = document.getElementById("borrowTable");
        let warnings = document.getElementById("warnings");
        let dashboardBorrowers = document.getElementById("dashboardBorrowers");
        let dashboardInventory = document.getElementById("dashboardInventory");
        let reportBorrowers = document.getElementById("reportBorrowers");
        eqTable.innerHTML =
          bEquip.innerHTML =
          borrowTable.innerHTML =
          warnings.innerHTML =
          dashboardBorrowers.innerHTML =
          dashboardInventory.innerHTML =
          reportBorrowers.innerHTML =
            "";

        let today = new Date().toISOString().split("T")[0];

        // Equipments
        equipments.forEach((e, i) => {
          let borrowedQty = e.total - e.avail;
          let statusClass =
            e.avail === 0 ? "bad" : e.avail <= 2 ? "fair" : "good";
          let statusText =
            e.avail === 0
              ? "Out of Stock"
              : e.avail <= 2
                ? "Low Stock"
                : "Available";
          if (e.avail <= 2)
            warnings.innerHTML += `<li>Low stock: ${e.name} (${e.avail})</li>`;
          eqTable.innerHTML += `
            <tr>
                <td>${e.name}</td>
                <td>${e.type}</td>
                <td><span class="badge ${e.condition.toLowerCase()}">${e.condition}</span></td>
                <td>${e.avail}</td>
                <td>${e.total}</td>
                <td>
                <span class="badge ${statusClass}">${statusText}</span>
                <div class="actions">
                <i class="fas fa-pen" onclick="editEquipment(${i})"></i>
                <i class="fas fa-trash" onclick="deleteEquipment(${i})"></i>
                </div>
                </td>
            </tr>`;
          bEquip.innerHTML += `<option value="${i}">${e.name}</option>`;

          // Dashboard inventory
          dashboardInventory.innerHTML += `
            <tr>
                <td>${e.name}</td>
                <td>${e.total}</td>
                <td>${e.avail}</td>
                <td>${borrowedQty}</td>
                <td><span class="badge ${statusClass}">${statusText}</span></td>
                <td>
                  <div class="actions">
                    <i class="fas fa-pen" onclick="editEquipment(${i})" title="Edit"></i>
                    <i class="fas fa-trash" onclick="deleteEquipment(${i})" title="Delete"></i>
                  </div>
                </td>
              </tr>`;
        });

        // Borrowers
        borrowers.forEach((b, i) => {
          let status = b.status;
          let statusClass = "borrowed";
          if (status === "Returned") statusClass = "returned";
          if (status === "Borrowed" && today > b.due) {
            status = "Overdue";
            statusClass = "overdue";
            warnings.innerHTML += `<li>Overdue: ${b.name} (${b.equip})</li>`;
          }
          borrowTable.innerHTML += `
          <tr>
              <td>${b.name}</td>
              <td>${b.id}</td>
              <td>${b.course}</td>
              <td>${b.equip}</td>
              <td>${b.qty}</td>
              <td><span class="status-pill ${statusClass}">${status}</span></td>
              <td>${b.borrowed}</td>
              <td>${b.due}</td>
              <td>${b.returned}</td>
              <td>${b.status !== "Returned" ? `<button class="action return" onclick="returnItem(${i})">Return</button>` : "â€”"}</td>
            </tr>`;
          dashboardBorrowers.innerHTML += `
            <tr>
                <td>${b.name}</td>
                <td>${b.equip}</td>
                <td>${b.qty}</td>
                <td><span class="status-pill ${statusClass}">${status}</span></td>
            </tr>`;
          reportBorrowers.innerHTML += `
          <tr>
              <td>${b.name}</td>
              <td>${b.id}</td>
              <td>${b.equip}</td>
              <td>${b.qty}</td>
              <td><span class="status-pill ${statusClass}">${status}</span></td>
              <td>${b.borrowed}</td>
          </tr>`;

          let reportInventory = document.getElementById("reportInventory");
          reportInventory.innerHTML = "";

          equipments.forEach((e, i) => {
            let borrowedQty = e.total - e.avail;
            let statusClass =
              e.avail === 0 ? "bad" : e.avail <= 2 ? "fair" : "good";
            let statusText =
              e.avail === 0
                ? "Out of Stock"
                : e.avail <= 2
                  ? "Low Stock"
                  : "Available";

            reportInventory.innerHTML += `
        <tr>
          <td>${e.name}</td>
          <td>${e.total}</td>
          <td>${e.avail}</td>
          <td>${borrowedQty}</td>
          <td><span class="badge ${statusClass}">${statusText}</span></td>
        </tr>
  `;
          });
        });

        // Dashboard stats
        let totalT = equipments.reduce((s, e) => s + e.total, 0);
        let availT = equipments.reduce((s, e) => s + e.avail, 0);
        document.getElementById("total").innerText = totalT;
        document.getElementById("available").innerText = availT;
        document.getElementById("borrowed").innerText = totalT - availT;
        document.getElementById("count").innerText = borrowers.length;
      }

      // Add/Edit/Delete/Return
      function addEquipment() {
        let name = document.getElementById("eqName").value;
        let type = document.getElementById("eqType").value;
        let qty = parseInt(document.getElementById("eqQty").value);
        let condition = document.getElementById("eqCondition").value;
        if (!name || !type || !qty) return alert("Fill all fields");
        equipments.push({ name, type, total: qty, avail: qty, condition });
        document.getElementById("eqName").value =
          document.getElementById("eqType").value =
          document.getElementById("eqQty").value =
            "";
        save();
        render();
        toggleAddForm();
      }

      function editEquipment(i) {
        let e = equipments[i];
        let name = prompt("Name", e.name);
        if (!name) return;
        let type = prompt("Category", e.type);
        if (!type) return;
        let total = parseInt(prompt("Total", e.total));
        if (isNaN(total)) return alert("Invalid");
        let borrowed = e.total - e.avail;
        if (total < borrowed) return alert("Cannot reduce below borrowed");
        let condition = prompt("Condition", e.condition);
        if (!condition) return;
        e.name = name;
        e.type = type;
        e.total = total;
        e.avail = total - borrowed;
        e.condition = condition;
        save();
        render();
      }

      function deleteEquipment(i) {
        if (borrowers.some((b) => b.idx === i && b.status !== "Returned"))
          return alert("Cannot delete active borrowed equipment");
        if (confirm("Delete?")) {
          equipments.splice(i, 1);
          save();
          render();
        }
      }

      function borrow() {
        let i = parseInt(document.getElementById("bEquip").value);
        let q = parseInt(document.getElementById("bQty").value);
        let due = document.getElementById("bDue").value;
        let name = document.getElementById("bName").value;
        let id = document.getElementById("bID").value;
        let course = document.getElementById("bCourse").value;
        if (q <= 0 || q > equipments[i].avail) return alert("Invalid quantity");
        if (!due) return alert("Select due date");
        equipments[i].avail -= q;
        borrowers.push({
          name,
          id,
          course,
          equip: equipments[i].name,
          idx: i,
          qty: q,
          status: "Borrowed",
          borrowed: new Date().toISOString().split("T")[0],
          due,
          returned: "â€”",
        });
        document.getElementById("bName").value =
          document.getElementById("bID").value =
          document.getElementById("bCourse").value =
          document.getElementById("bQty").value =
          document.getElementById("bDue").value =
            "";
        save();
        render();
      }

      function returnItem(i) {
        borrowers[i].status = "Returned";
        borrowers[i].returned = new Date().toISOString().split("T")[0];
        equipments[borrowers[i].idx].avail += borrowers[i].qty;
        save();
        render();
      }

      // Reports filter/reset
      function applyReportFilter() {
        let from = document.getElementById("fromDate").value;
        let to = document.getElementById("toDate").value;

        render();

        if (from || to) {
          reportBorrowers.innerHTML = "";

          borrowers
            .filter(
              (b) => (!from || b.borrowed >= from) && (!to || b.borrowed <= to),
            )
            .forEach((b) => {
              let statusClass = "borrowed";
              if (b.status === "Returned") statusClass = "returned";
              if (
                b.status === "Borrowed" &&
                new Date().toISOString().split("T")[0] > b.due
              )
                statusClass = "overdue";

              reportBorrowers.innerHTML += `
          <tr>
            <td>${b.name}</td>
            <td>${b.id}</td>
            <td>${b.equip}</td>
            <td>${b.qty}</td>
            <td><span class="status-pill ${statusClass}">${b.status}</span></td>
            <td>${b.borrowed}</td>
          </tr>`;
            });
        }

        function resetReports() {
          document.getElementById("fromDate").value = document.getElementById(
            "toDate",
          ).value = "";
          render();
          toggleFilterModal();
        }
      }

      function resetReports() {
        document.getElementById("fromDate").value = document.getElementById(
          "toDate",
        ).value = "";
        render();
      }

      function searchEquipment(keyword) {
        keyword = keyword.toLowerCase();
        let rows = document.querySelectorAll("#eqTable tr");

        rows.forEach((row) => {
          let text = row.innerText.toLowerCase();
          row.style.display = text.includes(keyword) ? "" : "none";
        });
      }

      function searchBorrowers(keyword) {
        keyword = keyword.toLowerCase();
        let rows = document.querySelectorAll("#borrowTable tr");

        rows.forEach((row) => {
          let text = row.innerText.toLowerCase();
          row.style.display = text.includes(keyword) ? "" : "none";
        });
      }

      function toggleFilterModal() {
        document.getElementById("filterModal").classList.toggle("hidden");
      }

      // Initial render
      render();
    </script>
  </body>
</html>
